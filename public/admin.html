<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Dashboard - Services</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
    h1 { text-align: center; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { padding: 12px; border: 1px solid #ddd; text-align: left; }
    th { background: #007BFF; color: #fff; }
    tr:nth-child(even) { background: #f2f2f2; }
    button { padding: 6px 12px; color: #fff; background: #dc3545; border: none; cursor: pointer; }
    button:hover { background: #c82333; }
  </style>
</head>
<body>
  <h1>Admin Dashboard - All Services</h1>
  <table>
    <thead>
      <tr>
        <th>ID</th>
        <th>Title</th>
        <th>Provider ID</th>
        <th>Price</th>
        <th>Category</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody id="servicesTable">
      <!-- Services will be injected here -->
    </tbody>
  </table>

  <script>
    const servicesTable = document.getElementById('servicesTable');

    // Fetch all services from backend
    async function fetchServices() {
      try {
        const res = await fetch('/api/admin/services'); // You need to implement GET endpoint
        const services = await res.json();

        servicesTable.innerHTML = ''; // Clear table

        services.forEach(service => {
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${service.id}</td>
            <td>${service.title}</td>
            <td>${service.user_id}</td>
            <td>${service.price}</td>
            <td>${service.category}</td>
            <td>
              <button onclick="deleteService(${service.id}, ${service.user_id})">
                Delete
              </button>
            </td>
          `;
          servicesTable.appendChild(tr);
        });

      } catch (err) {
        console.error('Error fetching services:', err);
      }
    }

    // Delete a service
    async function deleteService(id, providerId) {
      const reason = prompt('Enter reason for deleting this service (min 10 characters):');
      if (!reason || reason.trim().length < 10) {
        alert('Reason must be at least 10 characters');
        return;
      }

      try {
        const res = await fetch(`/api/admin/services/${id}`, {
          method: 'DELETE',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ reason, provider_user_id: providerId })
        });
        const data = await res.json();
        if (data.success) {
          alert(`Service "${data.deleted_service.title}" deleted successfully`);
          fetchServices(); // Refresh the table
        } else {
          alert('Error: ' + data.error);
        }
      } catch (err) {
        console.error('Delete error:', err);
      }
    }

    // Load services on page load
    fetchServices();
  </script>
</body>
</html>
